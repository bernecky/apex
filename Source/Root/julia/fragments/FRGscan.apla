'% Code fragments for scans',(⎕UCS 10),'% 1995-07-04',(⎕UCS 10),'%',(⎕UCS 10),'% Supports arbitrary user array index origin 1996-03-26 /rbe',(⎕UCS 10),'%',(⎕UCS 10),'%Fragment bsl x00 bid bid bid .',(⎕UCS 10),'inline $ZTYPE $FNAME($YTYPE y)',(⎕UCS 10),'{ /* Scan of a scalar */',(⎕UCS 10),' return(y);',(⎕UCS 10),'}',(⎕UCS 10 10),'%Fragment bsl x11 bid bid bid .',(⎕UCS 10),'inline $ZTYPE[.] $FNAME($YTYPE[.] y)',(⎕UCS 10),'{ /* Scan of vector */',(⎕UCS 10),'/* This does the scan in the wrong direction, but since',(⎕UCS 10),' * we assume associative functions only, it should be ok.',(⎕UCS 10),' */',(⎕UCS 10),' size = shape(y);',(⎕UCS 10),' z = genarray(size,Ito$ZT($FRID));',(⎕UCS 10),' if (0 != size[[0]]) {',(⎕UCS 10),'        /* real work to do */ ',(⎕UCS 10),'        z[[0]] = $YTto$ZT(y[[0]]); /* Not sure about the coercion... */',(⎕UCS 10),'        for ( i=1; i<size[[0]]; i++) {',(⎕UCS 10),'                z[[i]] = $FN$ZT$ZT$ZT($YTto$ZT(z[[i-1]]),$YTto$ZT(y[[i]]));',(⎕UCS 10),'        }',(⎕UCS 10),'  }',(⎕UCS 10),' return(z);',(⎕UCS 10),'}',(⎕UCS 10),'%Generate , $FN, $ZT$ZT$ZT, 000, ., $ZT',(⎕UCS 10 10),'%Fragment  bsl1  x22 bid bid bid . ',(⎕UCS 10),'inline $ZTYPE[.,.] $FNAME($YTYPE[.,.] y)',(⎕UCS 10),'{ /* Scan of matrix along first axis */',(⎕UCS 10),'y = TRANSPOSE(y);',(⎕UCS 10),'defcell = genarray(take([-1], shape(y)), $OTFILL);',(⎕UCS 10),'z = with{',(⎕UCS 10),'        (. <= iv <= .) :  $FNAME(y[iv]);',(⎕UCS 10),'        } : genarray(drop([-1],shape(y)), defcell);',(⎕UCS 10),' return(TRANSPOSE(z));',(⎕UCS 10),'}',(⎕UCS 10),'%Generate $FN, bsl, X$YT$ZT, X11, ., $CT',(⎕UCS 10),'%Generate , TRANSPOSE, X$YT$YT, X**, ., $CT',(⎕UCS 10),'%Generate , TRANSPOSE, X$ZT$ZT, X**, ., $CT',(⎕UCS 10 10),'%Fragment  bsl  x22 bid bid bid . ',(⎕UCS 10),'inline $ZTYPE[.,.] $FNAME($YTYPE[.,.] y)',(⎕UCS 10),'{ /* Scan of matrix along last axis */',(⎕UCS 10),'defcell = genarray(take([-1], shape(y)), $OTFILL);',(⎕UCS 10),'z = with{',(⎕UCS 10),'        (. <= iv <= .) :  $FNAME(y[iv]);',(⎕UCS 10),'        } : genarray(drop([-1],shape(y)), defcell);',(⎕UCS 10),' return(z);',(⎕UCS 10),'}',(⎕UCS 10),'%Generate $FN, bsl, X$YT$ZT, X11, ., $CT',(⎕UCS 10 10)
