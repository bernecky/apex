('% QUADfi and QUADvi code fragments',(⎕UCS 10),'%',(⎕UCS 10),'% Robert Bernecky 2006-03-05',(⎕UCS 10),'%',(⎕UCS 10),'% --------------- QUADfi fragments ----------------------------',(⎕UCS 10),'%Fragment quadfi x01  x c d .',(⎕UCS 10),'inline $ZTYPE[.] $FNAME($YTYPE y)',(⎕UCS 10),'{ /* QUADfi on scalar */',(⎕UCS 10),' z = toi(y)-toi(''0'');',(⎕UCS 10),' z = z * toi((z>=0) & (z<=9));',(⎕UCS 10),' return([z]);',(⎕UCS 10),'}',(⎕UCS 10 10),'%Fragment quadfi x11  x c d .',(⎕UCS 10),'inline $ZTYPE[.] $FNAME($YTYPE[.] y)',(⎕UCS 10),'{ /* BROKEN!!!  QUADfi on vector */',(⎕UCS 10),'zshape = with {',(⎕UCS 10),'         ([0] <= iv < shape(y)-[1])',(⎕UCS 10),'                : toi(('' '' == y[iv]) && ('' '' != y[iv+[1]]));',(⎕UCS 10),'        } : fold(+, 0);',(⎕UCS 10),' zshape= zshape+1;',(⎕UCS 10),' z = genarray([zshape],-42.0);',(⎕UCS 10),' str = to_string(y);',(⎕UCS 10),' for(i=0; i<zshape; i++){',(⎕UCS 10),'        v,str = strtod(str);',(⎕UCS 10),'        z[i] = v;',(⎕UCS 10),'        }',(⎕UCS 10),' return(z);',(⎕UCS 10),'}',(⎕UCS 10 10),'% --------------- QUADvi fragments ----------------------------',(⎕UCS 10),'%Fragment quadvi x01  x c bid .',(⎕UCS 10),'inline $ZTYPE[.] $FNAME($YTYPE y)',(⎕UCS 10),'{ /* QUADvi on scalar */',(⎕UCS 10),' z = toi( (y>=''0'') & (y<=''9''));',(⎕UCS 10),' return([z]);',(⎕UCS 10),'}',(⎕UCS 10 10),'%Fragment quadvi x11  x c bid .',(⎕UCS 10),'inline $ZTYPE[.] $FNAME($YTYPE[.] y)',(⎕UCS 10),'{ /* QUADvi on vector */',(⎕UCS 10),'zshape = with {',(⎕UCS 10),'        ([0] <= iv < shape(y)-[1])',(⎕UCS 10),'                : toi(('' '' == y[iv]) && ('' '' != y[iv+[1]]));',(⎕UCS 10),'        } : fold(+, 0);',(⎕UCS 10),' zshape= zshape+1;',(⎕UCS 10),' z = genarray([zshape], false);',(⎕UCS 10),' str = to_string(y);',(⎕UCS 10),' for(i=0; i<zshape; i++){',(⎕UCS 10),'        v,str = strtod(str);',(⎕UCS 10),'        z[i] = 0.0 != v;',(⎕UCS 10),'        }',(⎕UCS 10 10),' return(z);',(⎕UCS 10),'}',(⎕UCS 10))
