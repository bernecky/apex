('% SAC 2006-01-30 RBernecky',(⎕UCS 10),'% Code fragments for dyadic derived adverbs. ',(⎕UCS 10),'% At present, this is only window reduction.',(⎕UCS 10 10),'%Fragment sl 011 bid bid bid .',(⎕UCS 10),'inline $ZTYPE[.] $FNAME($XTYPE x, $YTYPE[.] y)',(⎕UCS 10),'{ /* Scalar window-reduce vector producing vector result */',(⎕UCS 10),'  /* FIXME: Need checks on x range and shape */ ',(⎕UCS 10),' rev = $XTtoI(x) < 0;      /* Reverse cell? */',(⎕UCS 10),' wid = [abs($XTtoI(x))];',(⎕UCS 10),' shp = 1+shape(y)-wid;',(⎕UCS 10),' z = with { ',(⎕UCS 10),'        (. <= iv <= .) {',(⎕UCS 10),'                cell = to$CT(tile( wid, iv, y));',(⎕UCS 10),'                cell = rev ? reverse(cell) : cell;',(⎕UCS 10),'                } : $FLVALUE$FRVALUEX$YT$ZT(cell);',(⎕UCS 10),'        } : genarray(shp);',(⎕UCS 10),' return(z);',(⎕UCS 10),'}',(⎕UCS 10),'%Generate $FLVALUE, $FN, X$YT$ZT, x10, ., $CT',(⎕UCS 10 10),'%Fragment sl 011 bid bid bid WIDTH2',(⎕UCS 10),'inline $ZTYPE[.] $FNAME($XTYPE x, $YTYPE[.] y)',(⎕UCS 10),'{ /* Width-2 window-reduce vector */',(⎕UCS 10),'  /* FIXME: Need checks on x range */ ',(⎕UCS 10),' shp = shape(y)-1;',(⎕UCS 10),' z = with { ',(⎕UCS 10),'        (. <= iv <= .) {',(⎕UCS 10),'                xel = $YTto$CT(y[iv]);',(⎕UCS 10),'                yel = $YTto$CT(y[iv + 1]);',(⎕UCS 10),'                } : $FLVALUE$CT$CT$ZT(xel,yel);',(⎕UCS 10),'        } : genarray(shp);',(⎕UCS 10),' return(z);',(⎕UCS 10),'}',(⎕UCS 10),'%Generate , $FLVALUE, $CT$CT$ZT, 000, ., $CT',(⎕UCS 10 10),'%Fragment sl 011 bid bid bid WIDTHN2',(⎕UCS 10),'inline $ZTYPE[.] $FNAME($XTYPE x, $YTYPE[.] y)',(⎕UCS 10),'{ /* Width-minus-2 window-reduce vector */',(⎕UCS 10),'  /* FIXME: Need checks on x range */ ',(⎕UCS 10),' shp = shape(y)-1;',(⎕UCS 10),' z = with { ',(⎕UCS 10),'        (. <= iv <= .) {',(⎕UCS 10),'                xel = $YTto$CT(y[iv]);',(⎕UCS 10),'                yel = $YTto$CT(y[iv + 1]);',(⎕UCS 10),'                } : $FLVALUE$CT$CT$ZT(yel,xel);',(⎕UCS 10),'        } : genarray(shp);',(⎕UCS 10),' return(z);',(⎕UCS 10),'}',(⎕UCS 10),'%Generate , $FLVALUE, $CT$CT$ZT, 000, ., $CT',(⎕UCS 10 10),'%Fragment sl 111 bid bid bid ONEEL',(⎕UCS 10),'inline $ZTYPE[.] $FNAME($XTYPE[1] x, $YTYPE[.] y)',(⎕UCS 10),'{ /* One-element vector window-reduce vector */',(⎕UCS 10),'  /* FIXME: Need checks on x range */ ',(⎕UCS 10),' rev = [$XTtoItoI(x) < 0)]; /* Reverse cell? */',(⎕UCS 10),' wid = [abs($XTtoI(x))];',(⎕UCS 10),' shp = [1]+shape(y)-wid;',(⎕UCS 10),' z = with { ',(⎕UCS 10),'        (. <= iv <= .) {',(⎕UCS 10),'                cell = $YTto$CT(tile( wid, iv, y));',(⎕UCS 10),'                cell = (rev) ? reverse(cell) : cell;',(⎕UCS 10),'        }',(⎕UCS 10),'                $FLVALUE$FRVALUEX$YT$ZT(cell);',(⎕UCS 10),'        } : genarray(shp);',(⎕UCS 10),' return(z);',(⎕UCS 10),'}',(⎕UCS 10),'%Generate $FLVALUE, $FN, X$YT$ZT, x10,.,  $CT',(⎕UCS 10))
