'% Code fragments for reshape fragments',(⎕UCS 10),'%',(⎕UCS 10),'% Rewritten for sac with help from Sven-Bodo Scholz.',(⎕UCS 10),'% Robert Bernecky 2004-09-17. Add SAC-like rank specifiers',(⎕UCS 10 10),'%Fragment rho 001 bid bidc bidc .',(⎕UCS 10),'inline $ZTYPE[.] $FNAME($XTYPE x, $YTYPE y)',(⎕UCS 10),'{ // [Scalar reshape scalar] ',(⎕UCS 10),'  z = genarray( [toi(x)],y);',(⎕UCS 10),'  return(z);',(⎕UCS 10),'}',(⎕UCS 10 10),'%Fragment rho 101 bid bidc bidc .',(⎕UCS 10),'inline $ZTYPE[.] $FNAME($XTYPE x, $YTYPE y)',(⎕UCS 10),'{ // [Vector reshape scalar] ',(⎕UCS 10),'  z = genarray( toi(x),y);',(⎕UCS 10),'  return(z);',(⎕UCS 10),'}',(⎕UCS 10 10),'%Fragment rho 0*1 bid bidc bidc .',(⎕UCS 10),'inline $ZTYPE[.] $FNAME($XTYPE x, $YTYPE[*] y)',(⎕UCS 10),'{ /* [Scalar reshape non-scalar] (to vector) */ ',(⎕UCS 10),' z = rhoI$YT$ZT( [toi(x)],y);',(⎕UCS 10),' return(z);',(⎕UCS 10),'}',(⎕UCS 10),'%Generate , rho, I$YT$YT, 1*1, ., $YT',(⎕UCS 10 10),'%Fragment rho 1** c bidc bidc .',(⎕UCS 10),'inline $ZTYPE[*] $FNAME($XTYPE[.] x, $YTYPE[*] y)',(⎕UCS 10),'{  /* Character-vector reshape anything. */',(⎕UCS 10),'   /* Left argument must be empty vector! */',(⎕UCS 10),'  if( 0 != shape(x)[[0]]) {',(⎕UCS 10),'    show(tochar("reshape domain error in $FNAME"));',(⎕UCS 10),'  }',(⎕UCS 10),'  z = y[ 0 * shape(y)];',(⎕UCS 10),'  return(z);',(⎕UCS 10),'}',(⎕UCS 10 10),'%Fragment rho 1** bid bidc bidc .',(⎕UCS 10),'inline $ZTYPE[*] $FNAME($XTYPE[.] x, $YTYPE[*] y)',(⎕UCS 10),'{  /* APEX vector x reshape, with potential item reuse */ ',(⎕UCS 10),'   z = with {',(⎕UCS 10),'         ( . <= iv <= .) {',(⎕UCS 10),'           offset = V2O( toi( x), iv);',(⎕UCS 10),'           offset = _mod_SxS_( offset, prod( shape(y)));',(⎕UCS 10),'           el = y[ O2V( shape( y), offset)];',(⎕UCS 10),'          } : el;',(⎕UCS 10),'       } : genarray( toi(x), $OTFILL);',(⎕UCS 10),'   return( z);',(⎕UCS 10),'}',(⎕UCS 10),'%Generate , V2O, III, 011, ., I ',(⎕UCS 10),'%Generate , O2V, III, 110, ., I ',(⎕UCS 10 10),'%Fragment rho *** bidc bidc bidc .',(⎕UCS 10),'inline $ZTYPE[*] $FNAME($XTYPE[*] x, $YTYPE[*] y)',(⎕UCS 10),'{ /* x rank>1! rank error! */',(⎕UCS 10),' APEXERROR("rank error"++__FILE__++__LINE__);',(⎕UCS 10),' return(y);',(⎕UCS 10),'}',(⎕UCS 10)
