 r←larg GenCode asts;i;mn;fns;sis;m;fldr;j;p;fnm;mkmn
 (fldr mkmn)←larg
 :if mkmn≡,0
    r←E''
 :else
 i←mkmn EmitOneUserDefinedFn¨asts ⍝ Emit all user-defined fns
 fns←D nub ER1 D Raze 1⊃¨i
 sis←((E fns),E mkmn) EmitPrimitiveFnDefns asts
 sis←D Raze sis,D Raze 0⊃¨i
 p←FullPathName fldr,PathDelim,'src'
 j←⎕SH'mkdir -p ',p ⍝ create subfldr if need be
 m←D 1⌷FileNameBreak fldr ⍝ Filename only
 fnm←p,PathDelim,m
 r←EmitOutputFile(E asts),(E sis),E fnm
 :endif
